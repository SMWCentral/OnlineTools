import*as e from"@smwcentral/bps";export default function(t){const a=t.byID("rom"),s=t.byID("patch"),n=t.byID("button");t.setStatus({message:"Select a Base ROM and a Patch."});let r=null;async function l(){n.disabled=!0;try{const l=a.files[0],o=s.files[0];if(null==l&&null==o)return void t.setStatus({message:"Select a Base ROM and a Patch."});if(null==l)return void t.setStatus({message:"Select a Base ROM."});if(null==o)return void t.setStatus({message:"Select a Patch."});const[c,i]=await Promise.all([l.arrayBuffer(),o.arrayBuffer()]),u=new Uint8Array(c),d=new Uint8Array(i),f=e.adaptiveApplyBPS(u,d),p=o.name.slice(0,o.name.lastIndexOf(".")),h=l.name.split(".").pop();r={name:`${p}.${h}`,blob:new Blob([f],{type:l.type})},n.disabled=!1,t.setStatus({success:"Patch successful."})}catch(a){a instanceof e.MalformedPatchError?t.setStatus({error:"This is not a BPS patch."}):a instanceof e.WrongInputError?t.setStatus({error:"This patch is not intended for this ROM."}):a instanceof e.PatchError?(console.log(a),t.setStatus({error:"Couldn't apply patch."})):(console.log(a),t.setStatus({error:"Internal error."}))}}a.addEventListener("change",l),s.addEventListener("change",l),n.addEventListener("click",()=>{null!=r&&t.download(r.name,r.blob)})}