/*!
 * license: you may do whatever you want with this file, except blame the author if anything goes wrong
 * author: https://www.smwcentral.net/?p=profile&id=1686
 * smc support by randomdude999 (https://smwc.me/u/32552)
 * SMB2 version correction by CircleFriendo (https://smwc.me/u/49634)
*/
const g=Symbol("wrong input file"),o=Symbol("not a BPS patch"),C=new Map([[g,"This patch is not intended for this ROM."],[o,"Not a BPS patch."]]),B=[];for(let g=0;g<256;g+=1){let o=g;for(let g=0;g<8;g+=1)o=1&o?3988292384^o>>>1:o>>>1;B[g]=o}function I(g){let o=-1;for(let C=0;C<g.length;C+=1)o=o>>>8^B[255&(o^g[C])];return(-1^o)>>>0}const e=(g,o)=>(g[o+0]<<0|g[o+1]<<8|g[o+2]<<16|g[o+3]<<24)>>>0;function K(C,B){let K=0;const a=()=>B[K++];function i(){let g=0,o=0;for(;;){const C=a();if(g+=(128^C)<<o,128&C)return g;o+=7}}function t(){const g=i(),o=g>>1;return 1&g?-o:o}if(66!==a()||80!==a()||83!==a()||49!==a())throw o;if(i()!==C.length)throw g;if(I(C)!==e(B,B.length-12))throw g;const r=new Uint8Array(i());let n=0;const G=i();K+=G;let S=0,s=0;for(;K<B.length-12;){const g=i(),o=1+(g>>2);switch(3&g){case 0:for(let g=0;g<o;g+=1)r[n]=C[n],n++;break;case 1:for(let g=0;g<o;g+=1)r[n++]=a();break;case 2:S+=t();for(let g=0;g<o;g+=1)r[n++]=C[S++];break;case 3:s+=t();for(let g=0;g<o;g+=1)r[n++]=r[s++]}}return r}const a=Symbol("Rev 0"),i=Symbol("Rev A"),t={2101309245:{name:"Super Mario Bros. 2 (U) (PRG0) [!].nes",revision:a,unheaderedCode:1470916527,header:[78,69,83,26,8,16,64,0,0,0,0,0,0,0,0,0]},1129345586:{name:"Super Mario Bros. 2 (USA).nes",revision:a,unheaderedCode:1470916527,header:[78,69,83,26,8,16,64,8,0,0,7,0,0,0,0,1]},3771351644:{name:"Super Mario Bros. 2 (USA) (Rev A).nes",revision:i,unheaderedCode:3394849486,header:[78,69,83,26,8,16,64,0,0,0,0,0,0,0,0,0]}},r=Uint8Array.fromBase64("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"),n=Uint8Array.fromBase64("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");export default function(o){const B=o.byID("rom"),a=o.byID("patch"),i=o.byID("button");o.setStatus({message:"Select a Base ROM and a Patch."});let G=null;async function S(){i.disabled=!0;try{const C=B.files[0],S=a.files[0];if(null==C&&null==S)return void o.setStatus({message:"Select a Base ROM and a Patch."});if(null==C)return void o.setStatus({message:"Select a Base ROM."});if(null==S)return void o.setStatus({message:"Select a Patch."});const[s,c]=await Promise.all([C.arrayBuffer(),S.arrayBuffer()]),l=function(o,C){const B=new Uint8Array(o),a=new Uint8Array(C);try{return K(B,a)}catch(o){if(o!==g)throw o}const i=e(a,a.length-12);if(i in t){const g=t[i].header,C=I(new Uint8Array(o,16));if(C===t[i].unheaderedCode){const o=Uint8Array.from(B);return o.set(g),K(o,a)}if(C==t[2101309245].unheaderedCode&&t[i].unheaderedCode==t[3771351644].unheaderedCode){const o=Uint8Array.from(B);o.set(t[2101309245].header);const C=K(o,r),I=Uint8Array.from(C);return I.set(g),K(I,a)}if(C==t[3771351644].unheaderedCode&&t[i].unheaderedCode==t[2101309245].unheaderedCode){const o=Uint8Array.from(B);o.set(t[3771351644].header);const C=K(o,n),I=Uint8Array.from(C);return I.set(g),K(I,a)}}try{const g=K(new Uint8Array(o,512),a);let C=new Uint8Array(g.length+512);return C.set(new Uint8Array(o,0,512)),C.set(g,512),C}catch(o){if(o!==g)throw o}throw g}(s,c),y=S.name.slice(0,S.name.lastIndexOf(".")),q=C.name.split(".").pop();G={name:`${y}.${q}`,blob:new Blob([l],{type:C.type})},i.disabled=!1,o.setStatus({success:"Patch successful."})}catch(g){C.has(g)?o.setStatus({error:C.get(g)}):(console.log(g),o.setStatus({error:"Internal error."}))}}B.addEventListener("change",S),a.addEventListener("change",S),i.addEventListener("click",(()=>{null!=G&&o.download(G.name,G.blob)}))}